# For sanity and performance, local packages must be Yalc'd into this directory BEFORE
# building this image (via ../../scripts/setup-framework-tests.sh)

ARG NODE_VERSION=14

# 'base' is deps + project source: plain files only, without any checks or test cases
FROM node:${NODE_VERSION}-buster-slim as base

WORKDIR /framework-test-cra5-react17
COPY package.json pnpm-lock.yaml  ./
COPY .yalc  .yalc/

RUN corepack enable
RUN pnpm install

COPY .env* *.cjs *.html *.js *.json *.mjs *.ts  ./
COPY public public/
COPY src src/

# 3000 = react-scripts start
EXPOSE 3000


# A target for each check or test case. These are just for readability.
#   'run-all'     = all project checks
#   'run-ci'      = all project checks, but for CI
#   'run-server'  = spin up a local dev server

FROM base as run-all
CMD pnpm run all

FROM base as run-ci
CMD pnpm run all:ci

FROM base as run-server
CMD pnpm run start


FROM run-all as default
